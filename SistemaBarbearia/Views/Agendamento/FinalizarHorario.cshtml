@model SistemaBarbearia.ViewModels.Agendamentos.AgendamentoVW
@using SistemaBarbearia.Helper;
@{
    var action = Convert.ToString(ViewBag.Action);
    bool readOnly = Convert.ToBoolean(ViewBag.ReadOnly);
    //bool isEdit = action.ToLower() == "FinalizarHorario";
    var tam = action == "create" ? 7 : 6;
    ViewBag.Title = "Venda";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@Html.HiddenFor(k => k.finalizar)
@Html.HiddenFor(k => k.nrModeloAux)
@Html.HiddenFor(k => k.nrSerieAux)
@Html.HiddenFor(k => k.IdAgendaAux)
@Html.HiddenFor(k => k.IdCliente)
@Html.Hidden("flTblProdutos")
<div class="container-fluid">
    <div class="container">
        <ul class="breadcrumb breadcrumb-arrow">
            <li><a href="@Url.Action("Index")"><i class="fa fa-home"></i></a></li>
            <li class="active">Venda Serviço</li>
        </ul>
        @if (action == "create")
        {
            <div class="row">
                @Html.HiddenFor(u => u.flSituacao)
                <div class="form-row">
                    <div class="@Helper.Input2">
                        @Html.LabelFor(model => model.flSituacao, new { @class = "required" })
                        @Html.TextBoxFor(model => model.flSituacao, new { @class = "form-control", disabled = true })
                    </div>
                </div>
            </div>
        }
        <div class="form-row">
            <div class="col-sm-2">
                @Html.LabelFor(model => model.idAgenda, htmlAttributes: new { @class = "control-label required" })
                @Html.TextBoxFor(model => model.idAgenda, new { @class = "form-control number", maxlength = "2", disabled = true })
                @Html.ValidationMessageFor(model => model.idAgenda, "", new { @class = "text-danger" })
            </div>
            <div class="col-sm-2">
                @Html.LabelFor(model => model.nrModelo, htmlAttributes: new { @class = "control-label required" })
                @Html.TextBoxFor(model => model.nrModelo, new { @class = "form-control number", maxlength = "2" })
                @Html.ValidationMessageFor(model => model.nrModelo, "", new { @class = "text-danger" })
            </div>
            <div class="col-sm-2">
                @Html.LabelFor(model => model.nrSerie, htmlAttributes: new { @class = "control-label required" })
                @Html.TextBoxFor(model => model.nrSerie, new { @class = "form-control number", maxlength = "1" })
                @Html.ValidationMessageFor(model => model.nrSerie, "", new { @class = "text-danger" })
            </div>
            <div class="col-sm-3">
                @Html.LabelFor(model => model.dtNota, new { @class = "required" })
                <div class="input-group-append">
                    <span class="fa fa-calendar input-group-text" style="font-size:23px"></span>
                    @Html.TextBoxFor(model => model.dtNota, "{0:dd/MM/yyyy}", new { @class = "form-control datepicker date", disabled = true })
                </div>
                @Html.ValidationMessageFor(model => model.dtNota, null, new { @class = "text-danger" })
            </div>

        </div>

        <div class="form-row">
            <div class="col-sm-10">
                @Html.EditorFor(model => model.Cliente, "Clientes/Select", new { disabled = true })
            </div>
        </div>
        <div class="bs-callout bs-callout-primary">
            <h3 class="heading no-margin">Serviços</h3>
            <div id="divAddServico" disabled>
                <div class="form-row">
                    @Html.EditorFor(model => model.Servico, "Servicos/Select", new { disabled = true, flValorServico = "S" })
                </div>
            </div>
        </div>
        <div class="bs-callout bs-callout-primary">
            <h3 class="heading no-margin">Produtos</h3>
            <div id="divAddProduto">
                <div class="form-row">
                    @Html.EditorFor(model => model.Produto, "Produtos/SelectVenda", new { Disabled = false, Required = true, flValor = "S", flQuantidade = "S" })                    
                </div>
                <div class="form-row">
                    <button id="addProduto" type="button" class="btn btn-primary"><i class="fa fa-plus"></i> Adicionar</button>
                </div>
            </div>
            @Html.HiddenFor(model => model.jsProdutos)
            <table id="tblProduto" class="table table-striped table-bordered" style="width:100%">
                <thead class="table-dark">
                    <tr>

                        @if (action == "create")
                        {
                            <th width="5%"></th>
                        }
                        <th width="5%"></th>
                        <th width="10%">Id</th>
                        <th width="50%">Produto</th>
                        <th width="10%">Quant.</th>
                        <th width="10%">Vl.Venda</th>
                        <th width="10%">Total</th>
                    </tr>
                </thead>
                <tfoot>
                    <tr>
                        <td id="ftp" colspan="@tam" style="text-align:right"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div id="divFinaliza">
            <div class="form-row">
                <div class="col-sm-2">
                    @Html.Label("Valor Total Venda", new { @class = "required" })
                    @Html.TextBoxFor(model => model.vlTotal, new { @class = "form-control", placeholder = "0,00", style = "text-align: right" })
                </div>
                <div class="col-md-12">
                    @Html.EditorFor(model => model.CondicaoPagamento, "CondPagamento/Select", new { Required = true, Disabled = false, flParcela = "S" })
                </div>
            </div>

            <div class="separador"></div>
            @Html.HiddenFor(model => model.jsParcelas)
            <table id="tblParcela" class="table table-striped table-bordered" style="width:100%">
                <thead class="table-dark">
                    <tr>
                        <th width="15%">Nº parcela</th>
                        <th width="15%">Valor Parcela</th>
                        <th width="10%">Vencimento</th>
                        <th width="55%">Forma de pagamento</th>
                    </tr>
                </thead>
            </table>
        </div>
        <div class="separador"></div>
        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="submit" class="btn btn-success"> <i class="fa fa-save"></i>Finalizar</button>
            <a href="@Url.Action("Index")" class="btn btn-secondary" role="button" aria-pressed="true"> <i class="fa fa-arrow-left"></i> Voltar</a>
        </div>

    </div>
</div>
@section Scripts {
    <script type="text/javascript">
        var Action = {            
            getParcelas: "@Url.Action("JsGetParcelas", "CondPagamento")"
        }
    </script>
    @Scripts.Render("~/Scripts/Views/Agendamentos/FinalizarHorario.js")

}
